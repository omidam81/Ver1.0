@model Teeyoot.WizardSettings.ViewModels.ProductViewModel
@{
    Layout.Title = T("Add Product").ToString();

    Style.Include("multi-select/css/multi-select.css");

    Script.Require("jQuery");
    Script.Include("jquery.multi-select.js");
}

<h2>Add New Product</h2>

@using (Html.BeginFormAntiForgeryPost(Url.Action("EditProduct", "Product"), FormMethod.Post, new {id = "product_form"}))
{
    @Html.HiddenFor(m => m.Id)
    <fieldset>
        @Html.LabelFor(m => m.Name, T("Name"))
        @Html.TextBoxFor(m => m.Name, new {@class = "text large", id = "name"})
    </fieldset>
    <fieldset>
        @Html.Label(T("Colours").ToString())
        <select id="colours" multiple="multiple">
            @foreach (var productColour in Model.ProductColours)
            {
                <option style="background-color: @productColour.HexValue;" value="@productColour.Id" @if (productColour.Selected)
                                                                                                     {
                                                                                                         <text> selected="selected" </text>
                                                                                                     }
                        data-name="@productColour.Name" data-colour="@productColour.HexValue">
                    @productColour.Name
                </option>
            }
        </select>
        @Html.Label(T("Selected Colours").ToString())
        <table id="selected-colours-table" class="items">
            <thead>
            <tr>
                <td>
                    Color
                </td>
                <td>
                    Name
                </td>
                <td>
                    Base Cost
                </td>
                <td>
                    Action
                </td>
            </tr>
            </thead>
            <tbody>
            @for (var i = 0; i < Model.SelectedProductColours.Count; i++)
            {
                <tr class="product-colour-row">
                    <td class="product-colour-colour" style="background-color: @Model.SelectedProductColours[i].HexValue;">
                        @Html.HiddenFor(m => Model.SelectedProductColours[i].Id)
                        @Html.HiddenFor(m => Model.SelectedProductColours[i].ProductColourId)
                    </td>
                    <td class="product-colour-name">@Model.SelectedProductColours[i].Name</td>
                    <td class="product-colour-base-cost">
                        @Html.TextBoxFor(m => Model.SelectedProductColours[i].BaseCost)
                    </td>
                    <td>
                        <a href="javascript:;" class="remove-product-colour">Remove</a>
                    </td>
                </tr>
            }
            <tr class="product-colour-template product-colour-row" style="display: none;">
                <td class="product-colour-colour">
                </td>
                <td class="product-colour-name">
                </td>
                <td class="product-colour-base-cost">
                    <input type="text" value="0"/>
                </td>
                <td>
                    <a href="javascript:;" class="remove-product-colour">Remove</a>
                </td>
            </tr>
            </tbody>
        </table>
    </fieldset>
    <fieldset class="save-button">
        <button type="submit" class="primaryAction">Save</button>
    </fieldset>
}

@using (Script.Foot())
{
    <script>
        function addAndHandleProductColour(productColourId) {
            var selectedColourOption = $('#colours option[value="' + productColourId + '"]');
            var productColourTemplate = $('#selected-colours-table .product-colour-template').clone();
            var addedProductColour = $('#selected-colours-table tr:last').after(productColourTemplate);

            addedProductColour.removeClass('product-colour-template').show();

            $('.product-colour-colour', addedProductColour).css('background-color', selectedColourOption.data('colour'));
            $('.product-colour-name', addedProductColour).html(selectedColourOption.data('name'));

            $('.remove-product-colour').click(function() {
                $(this).closest('.product-colour-row').remove();
            });
        };

        $(document).ready(function() {
            $('#colours').multiSelect({
                keepOrder: true,
                afterSelect: function(values) {
                    addAndHandleProductColour(values[0]);
                }
            });

            $('#product_form').submit(function() {
                var name = $('#name').val();

                if ($.trim(name) === '') {
                    alert('Please enter Product Name.');
                    return false;
                }

                return true;
            });
        });
    </script>
}